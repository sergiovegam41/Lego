<?php

require __DIR__ . '/vendor/autoload.php';

use Core\Commands\CommandRouter;

// Ensure script is running from CLI
if (php_sapi_name() !== 'cli') {
    exit("This script can only be executed from the command line.\n");
}

/**
 * Lego Framework CLI
 *
 * Scalable command-line interface that routes commands to their respective handlers
 * Commands are automatically discovered from Core/Commands directory
 */

// Initialize command router
$router = new CommandRouter();

// Get command line arguments
$args = $argv;
array_shift($args); // Remove script name

// Get command name
$commandName = $args[0] ?? 'help';
$commandArgs = array_slice($args, 1); // Remove command name from args

// Handle special cases
switch ($commandName) {
    case '--help':
    case '-h':
        $commandName = 'help';
        break;

    case '--version':
    case '-v':
        echo "ðŸ§± Lego Framework CLI v1.0.0\n";
        echo "Build modular applications like assembling LEGO blocks\n";
        exit(0);
}

// Execute command
$success = $router->execute($commandName, array_merge([$commandName], $commandArgs));

// Exit with appropriate code
exit($success ? 0 : 1);
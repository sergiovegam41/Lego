# =Ë Bitácora - 07 Septiembre 2025

## =€ Implementaciones Realizadas

### 1. Sistema de Importaciones Relativas para Componentes

**Problema:** Los componentes usaban rutas absolutas largas como `"components/Core/Home/home.css"`

**Solución:** Implementamos sistema como Angular para usar rutas relativas:
```php
// L Antes (ruta absoluta)
protected $CSS_PATHS = ["components/Core/Home/home.css"];

//  Ahora (ruta relativa)
protected $CSS_PATHS = ["./home.css"];
```

**Implementación:**
- Agregado método `resolveRelativePath()` en `CoreComponent`
- Actualizado `css_imports()`, `js_imports()` y `generate_modulesJsWithArg()`
- Soporte para rutas complejas: `"./styles/main.css"`, `"../shared/utils.css"`
- Mantiene compatibilidad total con rutas absolutas

**Beneficios:**
- Código más limpio y mantenible
- Componentes más portables entre carpetas
- Experiencia como Angular/React
- Cero configuración adicional

### 2. Sistema de Decoradores API para Componentes

**Problema:** Se necesitaba una forma elegante de hacer componentes actualizables vía API sin duplicar lógica

**Solución:** Sistema de decoradores que reutiliza el método `render()` existente:
```php
#[ApiComponent('/view/inicio', methods: ['GET'])]
class HomeComponent extends CoreComponent {
    // El método render() existente se reutiliza automáticamente
}
```

**Implementación:**
- Creado `Core/Attributes/ApiComponent.php` (decorador PHP8)
- Implementado `Core/Services/ApiRouteDiscovery.php` (auto-descubrimiento)
- Integrado en `Routes/Views.php` con `ApiRouteDiscovery::discover()`
- Auto-registro de rutas basado en atributos

**Características:**
- Un solo decorador hace el componente actualizable
- Reutiliza el método `render()` - cero duplicación
- Auto-descubrimiento de componentes con decorador
- Configuración opcional: métodos HTTP, autenticación

### 3. Actualización de Arquitectura SPA

**Comprensión mejorada:** Lego es una SPA con Window Manager:
- `/` carga `MainComponent` (layout completo)
- `MenuComponent` contiene links como `/view/inicio`
- Window Manager hace `fetch('/view/inicio')` via Ajax
- Componentes se renderizan en `#home-page` como módulos
- Misma ruta `/view/inicio` para carga inicial y refresh

## =Ý Archivos Modificados

### Archivos Core
- `Core/Components/CoreComponent/CoreComponent.php` - Método resolución rutas relativas
- `Core/Attributes/ApiComponent.php` - Nuevo decorador
- `Core/Services/ApiRouteDiscovery.php` - Nuevo auto-descubrimiento
- `Routes/Views.php` - Integración auto-descubrimiento API

### Componentes Actualizados  
- `Views/Core/Home/HomeComponent.php` - Rutas relativas + decorador API

### Documentación
- `docs/COMO_CREAR_COMPONENTES.md` - Completamente actualizada con:
  - Sección nueva: Sistema de Importaciones Relativas
  - Sección nueva: Componentes con API  
  - Arquitectura SPA clarificada
  - Ejemplos actualizados con rutas relativas
  - Reglas importantes actualizadas

## <¯ Resultados

### Antes
```php
class MiComponente extends CoreComponent {
    protected $CSS_PATHS = ["components/Core/MiComponente/styles.css"];
    
    protected function component(): string {
        $this->JS_PATHS_WITH_ARG[] = [
            new ScriptCoreDTO("components/Core/MiComponente/script.js", [])
        ];
        return "<div>Contenido</div>";
    }
}
```

### Ahora  
```php
#[ApiComponent('/view/mi-componente', methods: ['GET'])]
class MiComponente extends CoreComponent {
    protected $CSS_PATHS = ["./styles.css"];
    
    protected function component(): string {
        $this->JS_PATHS_WITH_ARG[] = [
            new ScriptCoreDTO("./script.js", [])
        ];
        return "<div>Contenido actualizable</div>";
    }
}
```

## = Mejoras de Experiencia de Desarrollo

1. **Rutas más limpias**: `"./archivo.css"` vs `"components/largo/path/archivo.css"`
2. **APIs opcionales**: Solo agregar decorador cuando se necesite
3. **Cero configuración**: Auto-descubrimiento maneja todo
4. **Consistencia**: Misma filosofía que Angular/React
5. **Reutilización**: Un método `render()` para todo

## =Ë Estado Final

-  Sistema de importaciones relativas funcionando
-  Decoradores API implementados y probados
-  HomeComponent actualizado como ejemplo
-  Documentación completamente actualizada
-  Compatibilidad total mantenida
-  Arquitectura SPA clarificada

El framework Lego ahora tiene una experiencia de desarrollo moderna manteniendo su simplicidad y filosofía original.